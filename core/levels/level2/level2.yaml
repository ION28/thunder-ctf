imports:
- path: bucket.jinja
- path: service_account.jinja
- path: instance.jinja
- path: iam_policy.jinja

resources:
- name: level2-access
  type: service_account.jinja
- name: level2-bucket
  type: bucket_acl.jinja
  properties:
    nonce: //nonce//
    acl_entries:
    - service_account_id: level2-access
      role: READER
- name: level2-logging-instance
  type: instance.jinja
  properties:
    zone: us-west1-b
    ssh_credentials:
      username: //ssh_username//
      public_key: //ssh_public_key//
    startup_script: //startup_script//
    sa_scopes:
    - https://www.googleapis.com/auth/logging.read
- name: iam_policy
  type: iam_policy.jinja
  properties:
    bindings:
    - service_account_id: level2-access
      role:
        name: custom
        custom_nonce: //nonce//
        permissions:
        - compute.instances.get
        - compute.instances.list
        - compute.zones.list
        - compute.zones.get
        - storage.buckets.list
    - service_account_id: level2-logging-instance-sa
      role:
        name: roles/logging.viewer