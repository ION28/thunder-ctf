{% set BUCKET_NAME = env['name']+ '-' + env["deployment"]+ "-" + properties["nonce"] %}
{% set ACL_NAME = "acl-" + BUCKET_NAME %}

resources:
- type: storage.v1.bucket
  name: {{ BUCKET_NAME }}
  properties:
    predefinedAcl: {{ properties['predefinedAcl'] }}
    projection: full
    location: US
    storageClass: STANDARD
{% if properties['service_account'] %}
- type: storage.v1.bucketAccessControl
  name: {{ ACL_NAME }}
  properties:
    bucket: {{ BUCKET_NAME }}
    entity: user-{{ properties['service_account'] }}@{{ env['project'] }}.iam.gserviceaccount.com"
    role: {{ properties['service_account_role'] }}
{% endif %}